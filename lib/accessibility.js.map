{"version":3,"file":"accessibility.js","sourceRoot":"","sources":["../src/accessibility.ts"],"names":[],"mappings":"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","sourcesContent":["import { hasLabels, isHTMLElement } from './dom.js'\nimport { TraversalContext } from './traversal.js'\n\nconst isStandaloneFooter = (element: Element): boolean =>\n\t!element.closest(\n\t\t'article, aside, main, nav, section, [role=\"article\"], [role=\"complementary\"], [role=\"main\"], [role=\"navigation\"], [role=\"region\"]'\n\t)\n\nexport function getAccessibilityAttributes(\n\telement: Element,\n\t{ labels, getUniqueId }: Pick<TraversalContext, 'labels' | 'getUniqueId'>\n): Map<string, string> {\n\t// https://www.w3.org/TR/html-aria/\n\tconst attributes = new Map<string, string>()\n\tswitch (element.tagName) {\n\t\tcase 'A':\n\t\t\tattributes.set('role', 'link')\n\t\t\tbreak\n\t\tcase 'ARTICLE':\n\t\t\tattributes.set('role', 'article')\n\t\t\tbreak\n\t\tcase 'ASIDE':\n\t\t\tattributes.set('role', 'complementary')\n\t\t\tbreak\n\t\tcase 'BODY':\n\t\t\tattributes.set('role', 'document')\n\t\t\tbreak\n\t\tcase 'BUTTON':\n\t\tcase 'SUMMARY':\n\t\t\tattributes.set('role', 'button')\n\t\t\tbreak\n\t\tcase 'DD':\n\t\t\tattributes.set('role', 'definition')\n\t\t\tbreak\n\t\tcase 'DETAILS':\n\t\t\tattributes.set('role', 'group')\n\t\t\tbreak\n\t\tcase 'DFN':\n\t\t\tattributes.set('role', 'term')\n\t\t\tbreak\n\t\tcase 'DIALOG':\n\t\t\tattributes.set('role', 'dialog')\n\t\t\tbreak\n\t\tcase 'DT':\n\t\t\tattributes.set('role', 'term')\n\t\t\tbreak\n\t\tcase 'FIELDSET':\n\t\t\tattributes.set('role', 'group')\n\t\t\tbreak\n\t\tcase 'FIGURE':\n\t\t\tattributes.set('role', 'figure')\n\t\t\tbreak\n\t\tcase 'FOOTER':\n\t\t\tif (isStandaloneFooter(element)) {\n\t\t\t\tattributes.set('role', 'contentinfo')\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'FORM':\n\t\t\tattributes.set('role', 'form')\n\t\t\tbreak\n\t\tcase 'H1':\n\t\tcase 'H2':\n\t\tcase 'H3':\n\t\tcase 'H4':\n\t\tcase 'H5':\n\t\tcase 'H6':\n\t\t\tattributes.set('role', 'heading')\n\t\t\tattributes.set('aria-level', element.tagName.slice(1))\n\t\t\tbreak\n\t\tcase 'HEADER':\n\t\t\tif (isStandaloneFooter(element)) {\n\t\t\t\tattributes.set('role', 'banner')\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'HR':\n\t\t\tattributes.set('role', 'separator')\n\t\t\tbreak\n\t\tcase 'IMG': {\n\t\t\tconst alt = element.getAttribute('alt')\n\t\t\tif (alt === null || alt !== '') {\n\t\t\t\tattributes.set('role', 'img')\n\t\t\t\tif (alt) {\n\t\t\t\t\tattributes.set('aria-label', alt)\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak\n\t\t}\n\t\tcase 'INPUT':\n\t\t\tswitch ((element as HTMLInputElement).type) {\n\t\t\t\tcase 'button':\n\t\t\t\tcase 'image':\n\t\t\t\tcase 'reset':\n\t\t\t\tcase 'submit':\n\t\t\t\t\tattributes.set('role', 'button')\n\t\t\t\t\tbreak\n\t\t\t\tcase 'number':\n\t\t\t\t\tattributes.set('role', 'spinbutton')\n\t\t\t\t\tbreak\n\t\t\t\tcase 'range':\n\t\t\t\t\tattributes.set('role', 'slider')\n\t\t\t\t\tbreak\n\t\t\t\tcase 'checkbox':\n\t\t\t\t\tattributes.set('role', 'checkbox')\n\t\t\t\t\tbreak\n\t\t\t\tcase 'radio':\n\t\t\t\t\tattributes.set('role', 'radio')\n\t\t\t\t\tbreak\n\t\t\t\tcase 'email':\n\t\t\t\tcase 'tel':\n\t\t\t\t\tif (!element.hasAttribute('list')) {\n\t\t\t\t\t\tattributes.set('role', 'textbox')\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'LI':\n\t\t\tif (\n\t\t\t\telement.parentElement?.tagName === 'OL' ||\n\t\t\t\telement.parentElement?.tagName === 'UL' ||\n\t\t\t\telement.parentElement?.tagName === 'MENU'\n\t\t\t) {\n\t\t\t\tattributes.set('role', 'listitem')\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'LINK':\n\t\t\tif ((element as HTMLLinkElement).href) {\n\t\t\t\tattributes.set('role', 'link')\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'MAIN':\n\t\t\tattributes.set('role', 'main')\n\t\t\tbreak\n\t\tcase 'MATH':\n\t\t\tattributes.set('role', 'math')\n\t\t\tbreak\n\t\tcase 'OL':\n\t\tcase 'UL':\n\t\tcase 'MENU':\n\t\t\tattributes.set('role', 'list')\n\t\t\tbreak\n\t\tcase 'NAV':\n\t\t\tattributes.set('role', 'navigation')\n\t\t\tbreak\n\t\tcase 'OPTION':\n\t\t\tattributes.set('role', 'option')\n\t\t\tbreak\n\t\tcase 'PROGRESS':\n\t\t\tattributes.set('role', 'progressbar')\n\t\t\tbreak\n\t\tcase 'SECTION':\n\t\t\tattributes.set('role', 'region')\n\t\t\tbreak\n\t\tcase 'SELECT':\n\t\t\tattributes.set(\n\t\t\t\t'role',\n\t\t\t\t!element.hasAttribute('multiple') && (element as HTMLSelectElement).size <= 1 ? 'combobox' : 'listbox'\n\t\t\t)\n\t\t\tbreak\n\t\tcase 'TABLE':\n\t\t\tattributes.set('role', 'table')\n\t\t\tbreak\n\t\tcase 'THEAD':\n\t\tcase 'TBODY':\n\t\tcase 'TFOOT':\n\t\t\tattributes.set('role', 'rowgroup')\n\t\t\tbreak\n\t\tcase 'TEXTAREA':\n\t\t\tattributes.set('role', 'textbox')\n\t\t\tbreak\n\t\tcase 'TD':\n\t\t\tattributes.set('role', 'cell')\n\t\t\tbreak\n\t\tcase 'TH':\n\t\t\tattributes.set('role', element.closest('thead') ? 'columnheader' : 'rowheader')\n\t\t\tbreak\n\t\tcase 'TR':\n\t\t\tattributes.set('role', 'tablerow')\n\t\t\tbreak\n\t}\n\tif (element.hasAttribute('disabled')) {\n\t\tattributes.set('aria-disabled', 'true')\n\t}\n\tif (element.hasAttribute('placeholder')) {\n\t\tattributes.set('aria-placeholder', element.getAttribute('placeholder') || '')\n\t}\n\tconst tabIndex = element.getAttribute('tabindex')\n\tif (tabIndex) {\n\t\tattributes.set('tabindex', tabIndex)\n\t}\n\tif (isHTMLElement(element) && hasLabels(element) && element.labels) {\n\t\t// Need to invert the label[for] / [aria-labelledby] relationship\n\t\tattributes.set(\n\t\t\t'aria-labelledby',\n\t\t\t[...element.labels]\n\t\t\t\t.map(label => {\n\t\t\t\t\tlet labelId = label.id || labels.get(label)\n\t\t\t\t\tif (!labelId) {\n\t\t\t\t\t\tlabelId = getUniqueId('label')\n\t\t\t\t\t\tlabels.set(label, labelId)\n\t\t\t\t\t}\n\t\t\t\t\treturn labelId\n\t\t\t\t})\n\t\t\t\t.join(' ')\n\t\t)\n\t}\n\n\tfor (const attribute of element.attributes) {\n\t\tif (attribute.name.startsWith('aria-')) {\n\t\t\tattributes.set(attribute.name, attribute.value)\n\t\t}\n\t}\n\tconst customRole = element.getAttribute('role')\n\tif (customRole) {\n\t\tattributes.set('role', customRole)\n\t}\n\treturn attributes\n}\n"]}